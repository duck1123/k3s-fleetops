apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/instance: romm
    app.kubernetes.io/name: romm
  name: romm
  namespace: romm
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: romm
      app.kubernetes.io/name: romm
  template:
    metadata:
      labels:
        app.kubernetes.io/instance: romm
        app.kubernetes.io/name: romm
    spec:
      automountServiceAccountToken: true
      containers:
        - env:
            - name: ROMM_DB_HOST
              value: mariadb.mariadb
            - name: ROMM_DB_PORT
              value: "3306"
            - name: ROMM_DB_NAME
              value: romm
            - name: ROMM_DB_USER
              value: mariadb
            - name: ROMM_DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: password
                  name: romm-database-password
            - name: ROMM_AUTH_SECRET_KEY
              valueFrom:
                secretKeyRef:
                  key: authSecretKey
                  name: romm-admin-password
            - name: ROMM_ADMIN_USERNAME
              valueFrom:
                secretKeyRef:
                  key: username
                  name: romm-admin-password
            - name: ROMM_ADMIN_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: password
                  name: romm-admin-password
          image: ghcr.io/rommapp/romm:latest
          imagePullPolicy: IfNotPresent
          name: romm
          ports:
            - containerPort: 5000
              name: http
              protocol: TCP
          volumeMounts:
            - mountPath: /app/data
              name: data
            - mountPath: /app/config
              name: config
            - mountPath: /roms
              name: library
            - mountPath: /app/assets
              name: assets
            - mountPath: /app/resources
              name: resources
      serviceAccountName: default
      volumes:
        - name: data
          persistentVolumeClaim:
            claimName: romm-romm-data
        - name: config
          persistentVolumeClaim:
            claimName: romm-romm-config
        - name: library
          persistentVolumeClaim:
            claimName: romm-library
        - name: assets
          persistentVolumeClaim:
            claimName: romm-assets
        - name: resources
          persistentVolumeClaim:
            claimName: romm-resources
