apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  labels:
    app.kubernetes.io/instance: openldap
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: openldap
    helm.sh/chart: openldap-4.1.1
  name: openldap-release
spec:
  chart:
    spec:
      chart: openldap-stack-ha
      sourceRef:
        apiVersion: source.toolkit.fluxcd.io/v1beta1
        kind: HelmRepository
        name: jp-gouin
      version: 4.1.1
  interval: 5m
  values:
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
                - key: kubernetes.io/arch
                  operator: In
                  values:
                    - amd64
    customLdifFiles:
      10-organizational-units.ldif: |
        dn: ou=people,dc=example,dc=org
        objectclass: top
        objectclass: organizationalUnit
        ou: people

        dn: ou=groups,dc=example,dc=org
        objectclass: top
        objectclass: organizationalUnit
        ou: groups
    env:
      BITNAMI_DEBUG: "true"
      LDAPTLS_REQCERT: never
      LDAP_CONFIG_ADMIN_ENABLED: "yes"
      LDAP_CONFIG_ADMIN_USERNAME: admin
      LDAP_ENABLE_TLS: "yes"
      LDAP_HASH_PASSWORD: SHA512CRYPT
      LDAP_SCHEMAS: misc,ppolicy
      LDAP_SKIP_DEFAULT_TREE: "yes"
      LDAP_TLS_ENFORCE: "false"
    global:
      existingSecret: openldap
      ldapDomain: dc=example,dc=org
      ldapPort: 389
      sslLdapPort: 636
    image:
      pullPolicy: IfNotPresent
      repository: registry.gitlab.com/bitspur/rock8s/docker-openldap
      tag: 2.4.57
    initTLSSecret:
      secret: openldap-cert
      tls_enabled: true
    logLevel: info
    ltb-passwd:
      enabled: false
    nodeSelector: {}
    persistence:
      accessModes:
        - ReadWriteOnce
      enabled: true
      size: 1Gi
    phpldapadmin:
      enabled: false
      env:
        PHPLDAPADMIN_LDAP_CLIENT_TLS: "true"
      image:
        pullPolicy: IfNotPresent
        repository: osixia/phpldapadmin
        tag: 0.9.0
      ingress:
        annotations: null
        enabled: false
        hosts:
          - null
        path: /
        pathType: Prefix
    podAnnotations: {}
    replicaCount: 1
    replication:
      clusterName: cluster.local
      enabled: false
      interval: 00:00:00:10
      retry: 60
      starttls: critical
      timeout: 1
      tls_reqcert: never
    resources:
      limits:
        cpu: 500m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi
    service:
      annotations: {}
      externalIPs: []
      type: ClusterIP
    test:
      enabled: false
      image:
        pullPolicy: IfNotPresent
        repository: dduportal/bats
        tag: 0.4.0
    tolerations: []
    updateStrategy:
      type: RollingUpdate
